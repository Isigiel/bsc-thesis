# Memory access

Testing project can be found in the `code` folder.

## Linear access

### Code in test function
```cpp
WASM_EXPORT
uint32_t run(uint32_t n) {
    uint32_t array1[n];

//    random_shuffle(array1, n);
    for (int i = 0; i < n; ++i) {
        array1[i] = i+1;
    }
    array1[n-1] = 0;
    uint32_t nextStep = 1;
    while(nextStep){
        nextStep = array1[nextStep];
    }
    return nextStep;
}
```
Writes and reads from an array in a linear way.

### Results
Following are the average runtimes of on call in microseconds

`Wasm3 v0.4.6 on ESP32, build Feb 18 2020 13:18:32`   
`Setup time: 1662`
|Run    |WASM   |NATIVE |
|---    |---    |---    |
|1      |1808   |56     |
|2      |1802   |56     |
|3      |1802   |55     |
|4      |1801   |55     |
|5      |1802   |55     |
|6      |1802   |55     |
|7      |1802   |55     |
|8      |1802   |55     |
|9      |1801   |55     |
|10     |1802   |55     |
|11     |1802   |55     |
|12     |1802   |55     |
|13     |1802   |55     |
|14     |1801   |55     |
|15     |1802   |55     |
|16     |1802   |55     |
|17     |1802   |55     |
|18     |1802   |55     |
|19     |1801   |55     |
|20     |1802   |56     |
|21     |1802   |55     |
|22     |1802   |55     |
|23     |1802   |55     |
|24     |1801   |55     |
|25     |1802   |55     |
|26     |1802   |55     |
|27     |1802   |55     |
|28     |1802   |55     |
|29     |1801   |55     |
|30     |1802   |55     |
|31     |1802   |55     |
|32     |1802   |55     |
|33     |1802   |55     |
|34     |1801   |55     |
|35     |1802   |55     |
|36     |1802   |55     |
|37     |1802   |55     |
|38     |1802   |56     |
|39     |1801   |55     |
|40     |1802   |55     |
|41     |1802   |55     |
|42     |1802   |55     |
|43     |1802   |55     |
|44     |1801   |55     |
|45     |1802   |55     |
|46     |1802   |55     |
|47     |1802   |55     |
|48     |1802   |55     |
|49     |1801   |55     |
|50     |1802   |55     |
|51     |1802   |55     |
|52     |1802   |55     |
|53     |1802   |55     |
|54     |1801   |55     |
|55     |1802   |55     |
|56     |1802   |56     |
|57     |1802   |55     |
|58     |1802   |55     |
|59     |1802   |55     |
|60     |1801   |55     |
|61     |1802   |55     |
|62     |1802   |55     |
|63     |1802   |55     |
|64     |1802   |55     |
|65     |1801   |55     |
|66     |1802   |55     |
|67     |1802   |55     |
|68     |1802   |55     |
|69     |1802   |55     |
|70     |1801   |55     |
|71     |1802   |55     |
|72     |1802   |55     |
|73     |1802   |55     |
|74     |1802   |56     |
|75     |1801   |55     |
|76     |1802   |55     |
|77     |1802   |55     |
|78     |1802   |55     |
|79     |1802   |55     |
|80     |1801   |55     |
|81     |1802   |55     |
|82     |1802   |55     |
|83     |1802   |55     |
|84     |1802   |55     |
|85     |1801   |55     |
|86     |1802   |55     |
|87     |1802   |55     |
|88     |1802   |55     |
|89     |1802   |55     |
|90     |1801   |55     |
|91     |1802   |55     |
|92     |1802   |56     |
|93     |1802   |55     |
|94     |1802   |55     |
|95     |1801   |55     |
|96     |1802   |55     |
|97     |1802   |55     |
|98     |1802   |55     |
|99     |1802   |55     |
|100    |1801   |55     |

## Random access

### Code in test function
```cpp
unsigned short lfsr = 0xACE1u;
unsigned bit;

unsigned randWASM()
{
    bit  = ((lfsr >> 0) ^ (lfsr >> 2) ^ (lfsr >> 3) ^ (lfsr >> 5) ) & 1;
    return lfsr =  (lfsr >> 1) | (bit << 15);
}

void random_shuffle(unsigned int *list, int32_t N)
{
    for (int32_t i=0; i<N-1; ++i) {
        int32_t swap_ix = i + randWASM() % (N-i);
        unsigned int tmp = list[swap_ix];
        list[swap_ix] = list[i];
        list[i] = tmp;
    }
}

WASM_EXPORT
uint32_t run(uint32_t n) {
    uint32_t array1[n];

//    random_shuffle(array1, n);
    for (int i = 0; i < n; ++i) {
        array1[i] = i+1;
    }
    array1[n-1] = 0;
    uint32_t nextStep = 1;
    while(nextStep){
        nextStep = array1[nextStep];
    }
    return nextStep;
}
```
Writes and reads from an array randomly shuffled in memory.

### Results
Following are the average runtimes of on call in microseconds

`Wasm3 v0.4.6 on ESP32, build Feb 18 2020 13:21:31`   
`Setup time: 1680`
|Run    |WASM   |NATIVE |
|---    |---    |---    |
|1      |12265  |167    |
|2      |12243  |165    |
|3      |12242  |165    |
|4      |12242  |165    |
|5      |12242  |165    |
|6      |12243  |165    |
|7      |12242  |166    |
|8      |12242  |165    |
|9      |12242  |165    |
|10     |12243  |165    |
|11     |12242  |165    |
|12     |12242  |165    |
|13     |12242  |165    |
|14     |12243  |165    |
|15     |12242  |165    |
|16     |12242  |165    |
|17     |12242  |165    |
|18     |12243  |165    |
|19     |12242  |165    |
|20     |12242  |165    |
|21     |12242  |165    |
|22     |12242  |165    |
|23     |12242  |165    |
|24     |12242  |165    |
|25     |12242  |165    |
|26     |12243  |165    |
|27     |12242  |165    |
|28     |12242  |165    |
|29     |12242  |165    |
|30     |12242  |165    |
|31     |12243  |165    |
|32     |12242  |165    |
|33     |12242  |165    |
|34     |12242  |165    |
|35     |12243  |165    |
|36     |12242  |165    |
|37     |12242  |165    |
|38     |12242  |165    |
|39     |12243  |165    |
|40     |12242  |165    |
|41     |12242  |165    |
|42     |12242  |165    |
|43     |12243  |165    |
|44     |12242  |165    |
|45     |12243  |165    |
|46     |12242  |165    |
|47     |12243  |165    |
|48     |12242  |165    |
|49     |12242  |165    |
|50     |12242  |165    |
|51     |12243  |165    |
|52     |12242  |165    |
|53     |12242  |165    |
|54     |12242  |165    |
|55     |12243  |165    |
|56     |12242  |165    |
|57     |12242  |165    |
|58     |12242  |165    |
|59     |12243  |165    |
|60     |12242  |165    |
|61     |12242  |165    |
|62     |12242  |165    |
|63     |12242  |165    |
|64     |12243  |165    |
|65     |12242  |165    |
|66     |12242  |165    |
|67     |12242  |165    |
|68     |12243  |165    |
|69     |12242  |165    |
|70     |12242  |165    |
|71     |12242  |165    |
|72     |12243  |165    |
|73     |12242  |165    |
|74     |12242  |165    |
|75     |12242  |165    |
|76     |12243  |165    |
|77     |12242  |165    |
|78     |12242  |165    |
|79     |12242  |165    |
|80     |12242  |165    |
|81     |12242  |165    |
|82     |12242  |165    |
|83     |12242  |165    |
|84     |12243  |165    |
|85     |12242  |165    |
|86     |12242  |165    |
|87     |12242  |165    |
|88     |12242  |165    |
|89     |12242  |165    |
|90     |12242  |165    |
|91     |12242  |165    |
|92     |12243  |165    |
|93     |12242  |165    |
|94     |12242  |165    |
|95     |12242  |165    |
|96     |12243  |165    |
|97     |12242  |165    |
|98     |12242  |165    |
|99     |12242  |165    |
|100    |12242  |165    |

